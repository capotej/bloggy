<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Mongrel::Configurator</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Mongrel::Configurator</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/lib/mongrel/configurator_rb.html">
                lib/mongrel/configurator.rb
                </a>
        <br />
                <a href="../../files/lib/mongrel/configurator_rb.html">
                lib/mongrel/configurator.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
Implements a simple DSL for configuring a <a
href="../Mongrel.html">Mongrel</a> server for your purposes. More used by
framework implementers to setup <a href="../Mongrel.html">Mongrel</a> how
they like, but could be used by regular folks to add more things to an
existing mongrel configuration.
</p>
<p>
It is used like this:
</p>
<pre>
  require 'mongrel'
  config = Mongrel::Configurator.new :host =&gt; &quot;127.0.0.1&quot; do
    listener :port =&gt; 3000 do
      uri &quot;/app&quot;, :handler =&gt; Mongrel::DirHandler.new(&quot;.&quot;, load_mime_map(&quot;mime.yaml&quot;))
    end
    run
  end
</pre>
<p>
This will setup a simple <a href="DirHandler.html">DirHandler</a> at the
current directory and load additional mime types from mimy.yaml. The :host
=&gt; &quot;127.0.0.1&quot; is actually not specific to the servers but
just a hash of default parameters that all server or <a
href="Configurator.html#M000129">uri</a> calls receive.
</p>
<p>
When you are inside the block after <a
href="Configurator.html#M000121">Mongrel::Configurator.new</a> you can
simply call functions that are part of <a
href="Configurator.html">Configurator</a> (like server, <a
href="Configurator.html#M000129">uri</a>, <a
href="Configurator.html#M000130">daemonize</a>, etc) without having to
refer to anything else. You can also call these functions on the resulting
object directly for additional configuration.
</p>
<p>
A major thing about <a href="Configurator.html">Configurator</a> is that it
actually lets you configure multiple listeners for any hosts and ports you
want. These are kept in a map config.listeners so you can get to them.
</p>
<ul>
<li>:pid_file =&gt; Where to write the process ID.

</li>
</ul>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000144">change_privilege</a>&nbsp;&nbsp;
      <a href="#M000122">change_privilege</a>&nbsp;&nbsp;
      <a href="#M000148">cloaker</a>&nbsp;&nbsp;
      <a href="#M000126">cloaker</a>&nbsp;&nbsp;
      <a href="#M000147">cloaking_class</a>&nbsp;&nbsp;
      <a href="#M000125">cloaking_class</a>&nbsp;&nbsp;
      <a href="#M000152">daemonize</a>&nbsp;&nbsp;
      <a href="#M000130">daemonize</a>&nbsp;&nbsp;
      <a href="#M000161">debug</a>&nbsp;&nbsp;
      <a href="#M000139">debug</a>&nbsp;&nbsp;
      <a href="#M000160">join</a>&nbsp;&nbsp;
      <a href="#M000138">join</a>&nbsp;&nbsp;
      <a href="#M000128">listener</a>&nbsp;&nbsp;
      <a href="#M000150">listener</a>&nbsp;&nbsp;
      <a href="#M000133">load_mime_map</a>&nbsp;&nbsp;
      <a href="#M000155">load_mime_map</a>&nbsp;&nbsp;
      <a href="#M000153">load_plugins</a>&nbsp;&nbsp;
      <a href="#M000131">load_plugins</a>&nbsp;&nbsp;
      <a href="#M000154">load_yaml</a>&nbsp;&nbsp;
      <a href="#M000132">load_yaml</a>&nbsp;&nbsp;
      <a href="#M000164">log</a>&nbsp;&nbsp;
      <a href="#M000142">log</a>&nbsp;&nbsp;
      <a href="#M000121">new</a>&nbsp;&nbsp;
      <a href="#M000143">new</a>&nbsp;&nbsp;
      <a href="#M000134">plugin</a>&nbsp;&nbsp;
      <a href="#M000156">plugin</a>&nbsp;&nbsp;
      <a href="#M000157">redirect</a>&nbsp;&nbsp;
      <a href="#M000135">redirect</a>&nbsp;&nbsp;
      <a href="#M000123">remove_pid_file</a>&nbsp;&nbsp;
      <a href="#M000145">remove_pid_file</a>&nbsp;&nbsp;
      <a href="#M000149">resolve_defaults</a>&nbsp;&nbsp;
      <a href="#M000127">resolve_defaults</a>&nbsp;&nbsp;
      <a href="#M000158">run</a>&nbsp;&nbsp;
      <a href="#M000136">run</a>&nbsp;&nbsp;
      <a href="#M000162">run_config</a>&nbsp;&nbsp;
      <a href="#M000140">run_config</a>&nbsp;&nbsp;
      <a href="#M000141">setup_signals</a>&nbsp;&nbsp;
      <a href="#M000163">setup_signals</a>&nbsp;&nbsp;
      <a href="#M000159">stop</a>&nbsp;&nbsp;
      <a href="#M000137">stop</a>&nbsp;&nbsp;
      <a href="#M000129">uri</a>&nbsp;&nbsp;
      <a href="#M000151">uri</a>&nbsp;&nbsp;
      <a href="#M000124">write_pid_file</a>&nbsp;&nbsp;
      <a href="#M000146">write_pid_file</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">defaults</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">defaults</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">listeners</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">listeners</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">needs_restart</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">needs_restart</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000121" class="method-detail">
        <a name="M000121"></a>

        <div class="method-heading">
          <a href="#M000121" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(defaults={}, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
You pass in initial defaults and then a block to continue configuring.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000121-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000121-source">
<pre>
    <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 41</span>
41:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">defaults</span>={}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
42:       <span class="ruby-ivar">@listener</span> = <span class="ruby-keyword kw">nil</span>
43:       <span class="ruby-ivar">@listener_name</span> = <span class="ruby-keyword kw">nil</span>
44:       <span class="ruby-ivar">@listeners</span> = {}
45:       <span class="ruby-ivar">@defaults</span> = <span class="ruby-identifier">defaults</span>
46:       <span class="ruby-ivar">@needs_restart</span> = <span class="ruby-keyword kw">false</span>
47:       <span class="ruby-ivar">@pid_file</span> = <span class="ruby-identifier">defaults</span>[<span class="ruby-identifier">:pid_file</span>]
48: 
49:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block</span>
50:         <span class="ruby-identifier">cloaker</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>).<span class="ruby-identifier">bind</span>(<span class="ruby-keyword kw">self</span>).<span class="ruby-identifier">call</span>
51:       <span class="ruby-keyword kw">end</span>
52:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000143" class="method-detail">
        <a name="M000143"></a>

        <div class="method-heading">
          <a href="#M000143" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(defaults={}, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
You pass in initial defaults and then a block to continue configuring.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000143-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000143-source">
<pre>
    <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 41</span>
41:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">defaults</span>={}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
42:       <span class="ruby-ivar">@listener</span> = <span class="ruby-keyword kw">nil</span>
43:       <span class="ruby-ivar">@listener_name</span> = <span class="ruby-keyword kw">nil</span>
44:       <span class="ruby-ivar">@listeners</span> = {}
45:       <span class="ruby-ivar">@defaults</span> = <span class="ruby-identifier">defaults</span>
46:       <span class="ruby-ivar">@needs_restart</span> = <span class="ruby-keyword kw">false</span>
47:       <span class="ruby-ivar">@pid_file</span> = <span class="ruby-identifier">defaults</span>[<span class="ruby-identifier">:pid_file</span>]
48: 
49:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block</span>
50:         <span class="ruby-identifier">cloaker</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>).<span class="ruby-identifier">bind</span>(<span class="ruby-keyword kw">self</span>).<span class="ruby-identifier">call</span>
51:       <span class="ruby-keyword kw">end</span>
52:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000144" class="method-detail">
        <a name="M000144"></a>

        <div class="method-heading">
          <a href="#M000144" class="method-signature">
          <span class="method-name">change_privilege</span><span class="method-args">(user, group)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Change privileges of the process to specified user and group.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000144-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000144-source">
<pre>
    <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 55</span>
55:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">change_privilege</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">group</span>)
56:       <span class="ruby-keyword kw">begin</span>
57:         <span class="ruby-identifier">uid</span>, <span class="ruby-identifier">gid</span> = <span class="ruby-constant">Process</span>.<span class="ruby-identifier">euid</span>, <span class="ruby-constant">Process</span>.<span class="ruby-identifier">egid</span>
58:         <span class="ruby-identifier">target_uid</span> = <span class="ruby-constant">Etc</span>.<span class="ruby-identifier">getpwnam</span>(<span class="ruby-identifier">user</span>).<span class="ruby-identifier">uid</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">user</span>
59:         <span class="ruby-identifier">target_gid</span> = <span class="ruby-constant">Etc</span>.<span class="ruby-identifier">getgrnam</span>(<span class="ruby-identifier">group</span>).<span class="ruby-identifier">gid</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">group</span>
60: 
61:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">uid</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">target_uid</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">gid</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">target_gid</span>
62:           <span class="ruby-identifier">log</span> <span class="ruby-node">&quot;Initiating groups for #{user.inspect}:#{group.inspect}.&quot;</span>
63:           <span class="ruby-constant">Process</span>.<span class="ruby-identifier">initgroups</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">target_gid</span>)
64:         
65:           <span class="ruby-identifier">log</span> <span class="ruby-node">&quot;Changing group to #{group.inspect}.&quot;</span>
66:           <span class="ruby-constant">Process</span><span class="ruby-operator">::</span><span class="ruby-constant">GID</span>.<span class="ruby-identifier">change_privilege</span>(<span class="ruby-identifier">target_gid</span>)
67: 
68:           <span class="ruby-identifier">log</span> <span class="ruby-node">&quot;Changing user to #{user.inspect}.&quot;</span> 
69:           <span class="ruby-constant">Process</span><span class="ruby-operator">::</span><span class="ruby-constant">UID</span>.<span class="ruby-identifier">change_privilege</span>(<span class="ruby-identifier">target_uid</span>)
70:         <span class="ruby-keyword kw">end</span>
71:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">EPERM</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
72:         <span class="ruby-identifier">log</span> <span class="ruby-node">&quot;Couldn't change user and group to #{user.inspect}:#{group.inspect}: #{e.to_s}.&quot;</span>
73:         <span class="ruby-identifier">log</span> <span class="ruby-value str">&quot;Mongrel failed to start.&quot;</span>
74:         <span class="ruby-identifier">exit</span> <span class="ruby-value">1</span>
75:       <span class="ruby-keyword kw">end</span>
76:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000122" class="method-detail">
        <a name="M000122"></a>

        <div class="method-heading">
          <a href="#M000122" class="method-signature">
          <span class="method-name">change_privilege</span><span class="method-args">(user, group)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Change privileges of the process to specified user and group.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000122-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000122-source">
<pre>
    <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 55</span>
55:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">change_privilege</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">group</span>)
56:       <span class="ruby-keyword kw">begin</span>
57:         <span class="ruby-identifier">uid</span>, <span class="ruby-identifier">gid</span> = <span class="ruby-constant">Process</span>.<span class="ruby-identifier">euid</span>, <span class="ruby-constant">Process</span>.<span class="ruby-identifier">egid</span>
58:         <span class="ruby-identifier">target_uid</span> = <span class="ruby-constant">Etc</span>.<span class="ruby-identifier">getpwnam</span>(<span class="ruby-identifier">user</span>).<span class="ruby-identifier">uid</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">user</span>
59:         <span class="ruby-identifier">target_gid</span> = <span class="ruby-constant">Etc</span>.<span class="ruby-identifier">getgrnam</span>(<span class="ruby-identifier">group</span>).<span class="ruby-identifier">gid</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">group</span>
60: 
61:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">uid</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">target_uid</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">gid</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">target_gid</span>
62:           <span class="ruby-identifier">log</span> <span class="ruby-node">&quot;Initiating groups for #{user.inspect}:#{group.inspect}.&quot;</span>
63:           <span class="ruby-constant">Process</span>.<span class="ruby-identifier">initgroups</span>(<span class="ruby-identifier">user</span>, <span class="ruby-identifier">target_gid</span>)
64:         
65:           <span class="ruby-identifier">log</span> <span class="ruby-node">&quot;Changing group to #{group.inspect}.&quot;</span>
66:           <span class="ruby-constant">Process</span><span class="ruby-operator">::</span><span class="ruby-constant">GID</span>.<span class="ruby-identifier">change_privilege</span>(<span class="ruby-identifier">target_gid</span>)
67: 
68:           <span class="ruby-identifier">log</span> <span class="ruby-node">&quot;Changing user to #{user.inspect}.&quot;</span> 
69:           <span class="ruby-constant">Process</span><span class="ruby-operator">::</span><span class="ruby-constant">UID</span>.<span class="ruby-identifier">change_privilege</span>(<span class="ruby-identifier">target_uid</span>)
70:         <span class="ruby-keyword kw">end</span>
71:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">EPERM</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
72:         <span class="ruby-identifier">log</span> <span class="ruby-node">&quot;Couldn't change user and group to #{user.inspect}:#{group.inspect}: #{e.to_s}.&quot;</span>
73:         <span class="ruby-identifier">log</span> <span class="ruby-value str">&quot;Mongrel failed to start.&quot;</span>
74:         <span class="ruby-identifier">exit</span> <span class="ruby-value">1</span>
75:       <span class="ruby-keyword kw">end</span>
76:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000148" class="method-detail">
        <a name="M000148"></a>

        <div class="method-heading">
          <a href="#M000148" class="method-signature">
          <span class="method-name">cloaker</span><span class="method-args">(&amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Do not call this. You were warned.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000148-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000148-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 102</span>
102:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cloaker</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
103:       <span class="ruby-identifier">cloaking_class</span>.<span class="ruby-identifier">class_eval</span> <span class="ruby-keyword kw">do</span>
104:         <span class="ruby-identifier">define_method</span> <span class="ruby-identifier">:cloaker_</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
105:         <span class="ruby-identifier">meth</span> = <span class="ruby-identifier">instance_method</span>( <span class="ruby-identifier">:cloaker_</span> )
106:         <span class="ruby-identifier">remove_method</span> <span class="ruby-identifier">:cloaker_</span>
107:         <span class="ruby-identifier">meth</span>
108:       <span class="ruby-keyword kw">end</span>
109:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000126" class="method-detail">
        <a name="M000126"></a>

        <div class="method-heading">
          <a href="#M000126" class="method-signature">
          <span class="method-name">cloaker</span><span class="method-args">(&amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Do not call this. You were warned.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000126-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000126-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 102</span>
102:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cloaker</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
103:       <span class="ruby-identifier">cloaking_class</span>.<span class="ruby-identifier">class_eval</span> <span class="ruby-keyword kw">do</span>
104:         <span class="ruby-identifier">define_method</span> <span class="ruby-identifier">:cloaker_</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
105:         <span class="ruby-identifier">meth</span> = <span class="ruby-identifier">instance_method</span>( <span class="ruby-identifier">:cloaker_</span> )
106:         <span class="ruby-identifier">remove_method</span> <span class="ruby-identifier">:cloaker_</span>
107:         <span class="ruby-identifier">meth</span>
108:       <span class="ruby-keyword kw">end</span>
109:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000147" class="method-detail">
        <a name="M000147"></a>

        <div class="method-heading">
          <a href="#M000147" class="method-signature">
          <span class="method-name">cloaking_class</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Generates a class for cloaking the current self and making the DSL nicer.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000147-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000147-source">
<pre>
    <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 95</span>
95:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cloaking_class</span>
96:       <span class="ruby-keyword kw">class</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword kw">self</span>
97:         <span class="ruby-keyword kw">self</span>
98:       <span class="ruby-keyword kw">end</span>
99:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000125" class="method-detail">
        <a name="M000125"></a>

        <div class="method-heading">
          <a href="#M000125" class="method-signature">
          <span class="method-name">cloaking_class</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Generates a class for cloaking the current self and making the DSL nicer.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000125-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000125-source">
<pre>
    <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 95</span>
95:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">cloaking_class</span>
96:       <span class="ruby-keyword kw">class</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-keyword kw">self</span>
97:         <span class="ruby-keyword kw">self</span>
98:       <span class="ruby-keyword kw">end</span>
99:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000152" class="method-detail">
        <a name="M000152"></a>

        <div class="method-heading">
          <a href="#M000152" class="method-signature">
          <span class="method-name">daemonize</span><span class="method-args">(options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Daemonizes the current Ruby script turning all the listeners into an actual
&quot;server&quot; or detached process. You must call this <b>before</b>
frameworks that open files as otherwise the files will be closed by this
function.
</p>
<p>
Does not work for Win32 systems (the call is silently ignored).
</p>
<p>
Requires the following options or defaults:
</p>
<ul>
<li>:cwd =&gt; Directory to change to.

</li>
<li>:log_file =&gt; Where to write STDOUT and STDERR.

</li>
</ul>
<p>
It is safe to call this on win32 as it will only require the daemons
gem/library if NOT win32.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000152-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000152-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 185</span>
185:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">daemonize</span>(<span class="ruby-identifier">options</span>={})
186:       <span class="ruby-identifier">ops</span> = <span class="ruby-identifier">resolve_defaults</span>(<span class="ruby-identifier">options</span>)
187:       <span class="ruby-comment cmt"># save this for later since daemonize will hose it</span>
188:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">RUBY_PLATFORM</span> <span class="ruby-operator">!~</span> <span class="ruby-regexp re">/mswin/</span>
189:         <span class="ruby-identifier">require</span> <span class="ruby-value str">'daemons/daemonize'</span>
190: 
191:         <span class="ruby-identifier">logfile</span> = <span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:log_file</span>]
192:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logfile</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">chr</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;/&quot;</span>
193:           <span class="ruby-identifier">logfile</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:cwd</span>],<span class="ruby-identifier">logfile</span>)
194:           <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">not</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">logfile</span>))
195:             <span class="ruby-identifier">log</span> <span class="ruby-node">&quot;!!! Log file directory not found at full path #{File.dirname(logfile)}.  Update your configuration to use a full path.&quot;</span>
196:             <span class="ruby-identifier">exit</span> <span class="ruby-value">1</span>
197:           <span class="ruby-keyword kw">end</span>
198:         <span class="ruby-keyword kw">end</span>
199: 
200:         <span class="ruby-constant">Daemonize</span>.<span class="ruby-identifier">daemonize</span>(<span class="ruby-identifier">logfile</span>)
201: 
202:         <span class="ruby-comment cmt"># change back to the original starting directory</span>
203:         <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span>(<span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:cwd</span>])
204: 
205:       <span class="ruby-keyword kw">else</span>
206:         <span class="ruby-identifier">log</span> <span class="ruby-value str">&quot;WARNING: Win32 does not support daemon mode.&quot;</span>
207:       <span class="ruby-keyword kw">end</span>
208:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000130" class="method-detail">
        <a name="M000130"></a>

        <div class="method-heading">
          <a href="#M000130" class="method-signature">
          <span class="method-name">daemonize</span><span class="method-args">(options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Daemonizes the current Ruby script turning all the listeners into an actual
&quot;server&quot; or detached process. You must call this <b>before</b>
frameworks that open files as otherwise the files will be closed by this
function.
</p>
<p>
Does not work for Win32 systems (the call is silently ignored).
</p>
<p>
Requires the following options or defaults:
</p>
<ul>
<li>:cwd =&gt; Directory to change to.

</li>
<li>:log_file =&gt; Where to write STDOUT and STDERR.

</li>
</ul>
<p>
It is safe to call this on win32 as it will only require the daemons
gem/library if NOT win32.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000130-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000130-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 185</span>
185:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">daemonize</span>(<span class="ruby-identifier">options</span>={})
186:       <span class="ruby-identifier">ops</span> = <span class="ruby-identifier">resolve_defaults</span>(<span class="ruby-identifier">options</span>)
187:       <span class="ruby-comment cmt"># save this for later since daemonize will hose it</span>
188:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">RUBY_PLATFORM</span> <span class="ruby-operator">!~</span> <span class="ruby-regexp re">/mswin/</span>
189:         <span class="ruby-identifier">require</span> <span class="ruby-value str">'daemons/daemonize'</span>
190: 
191:         <span class="ruby-identifier">logfile</span> = <span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:log_file</span>]
192:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">logfile</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">chr</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;/&quot;</span>
193:           <span class="ruby-identifier">logfile</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:cwd</span>],<span class="ruby-identifier">logfile</span>)
194:           <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">not</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">logfile</span>))
195:             <span class="ruby-identifier">log</span> <span class="ruby-node">&quot;!!! Log file directory not found at full path #{File.dirname(logfile)}.  Update your configuration to use a full path.&quot;</span>
196:             <span class="ruby-identifier">exit</span> <span class="ruby-value">1</span>
197:           <span class="ruby-keyword kw">end</span>
198:         <span class="ruby-keyword kw">end</span>
199: 
200:         <span class="ruby-constant">Daemonize</span>.<span class="ruby-identifier">daemonize</span>(<span class="ruby-identifier">logfile</span>)
201: 
202:         <span class="ruby-comment cmt"># change back to the original starting directory</span>
203:         <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span>(<span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:cwd</span>])
204: 
205:       <span class="ruby-keyword kw">else</span>
206:         <span class="ruby-identifier">log</span> <span class="ruby-value str">&quot;WARNING: Win32 does not support daemon mode.&quot;</span>
207:       <span class="ruby-keyword kw">end</span>
208:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000161" class="method-detail">
        <a name="M000161"></a>

        <div class="method-heading">
          <a href="#M000161" class="method-signature">
          <span class="method-name">debug</span><span class="method-args">(location, what = [:access, :files, :objects, :threads, :rails])</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Calling this before you register your URIs to the given location will setup
a set of handlers that <a href="Configurator.html#M000142">log</a> open
files, objects, and the parameters for each request. This helps you track
common problems found in <a href="Rails.html">Rails</a> applications that
are either slow or become unresponsive after a little while.
</p>
<p>
You can pass an extra parameter <b>what</b> to indicate what you want to <a
href="Configurator.html#M000139">debug</a>. For example, if you just want
to dump rails stuff then do:
</p>
<pre>
  debug &quot;/&quot;, what = [:rails]
</pre>
<p>
And it will only produce the log/mongrel_debug/rails.log file. Available
options are: :access, :files, :objects, :threads, :rails
</p>
<p>
NOTE: Use [:files] to get accesses dumped to stderr like with WEBrick.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000161-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000161-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 322</span>
322:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">debug</span>(<span class="ruby-identifier">location</span>, <span class="ruby-identifier">what</span> = [<span class="ruby-identifier">:access</span>, <span class="ruby-identifier">:files</span>, <span class="ruby-identifier">:objects</span>, <span class="ruby-identifier">:threads</span>, <span class="ruby-identifier">:rails</span>])
323:       <span class="ruby-identifier">require</span> <span class="ruby-value str">'mongrel/debug'</span>
324:       <span class="ruby-identifier">handlers</span> = {
325:         <span class="ruby-identifier">:access</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;/handlers/requestlog::access&quot;</span>, 
326:         <span class="ruby-identifier">:files</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;/handlers/requestlog::files&quot;</span>, 
327:         <span class="ruby-identifier">:objects</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;/handlers/requestlog::objects&quot;</span>, 
328:         <span class="ruby-identifier">:threads</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;/handlers/requestlog::threads&quot;</span>,
329:         <span class="ruby-identifier">:rails</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;/handlers/requestlog::params&quot;</span>
330:       }
331: 
332:       <span class="ruby-comment cmt"># turn on the debugging infrastructure, and ObjectTracker is a pig</span>
333:       <span class="ruby-constant">MongrelDbg</span>.<span class="ruby-identifier">configure</span>
334: 
335:       <span class="ruby-comment cmt"># now we roll through each requested debug type, turn it on and load that plugin</span>
336:       <span class="ruby-identifier">what</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">type</span><span class="ruby-operator">|</span> 
337:         <span class="ruby-constant">MongrelDbg</span>.<span class="ruby-identifier">begin_trace</span> <span class="ruby-identifier">type</span> 
338:         <span class="ruby-identifier">uri</span> <span class="ruby-identifier">location</span>, <span class="ruby-identifier">:handler</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">plugin</span>(<span class="ruby-identifier">handlers</span>[<span class="ruby-identifier">type</span>])
339:       <span class="ruby-keyword kw">end</span>
340:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000139" class="method-detail">
        <a name="M000139"></a>

        <div class="method-heading">
          <a href="#M000139" class="method-signature">
          <span class="method-name">debug</span><span class="method-args">(location, what = [:access, :files, :objects, :threads, :rails])</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Calling this before you register your URIs to the given location will setup
a set of handlers that <a href="Configurator.html#M000142">log</a> open
files, objects, and the parameters for each request. This helps you track
common problems found in <a href="Rails.html">Rails</a> applications that
are either slow or become unresponsive after a little while.
</p>
<p>
You can pass an extra parameter <b>what</b> to indicate what you want to <a
href="Configurator.html#M000139">debug</a>. For example, if you just want
to dump rails stuff then do:
</p>
<pre>
  debug &quot;/&quot;, what = [:rails]
</pre>
<p>
And it will only produce the log/mongrel_debug/rails.log file. Available
options are: :access, :files, :objects, :threads, :rails
</p>
<p>
NOTE: Use [:files] to get accesses dumped to stderr like with WEBrick.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000139-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000139-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 322</span>
322:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">debug</span>(<span class="ruby-identifier">location</span>, <span class="ruby-identifier">what</span> = [<span class="ruby-identifier">:access</span>, <span class="ruby-identifier">:files</span>, <span class="ruby-identifier">:objects</span>, <span class="ruby-identifier">:threads</span>, <span class="ruby-identifier">:rails</span>])
323:       <span class="ruby-identifier">require</span> <span class="ruby-value str">'mongrel/debug'</span>
324:       <span class="ruby-identifier">handlers</span> = {
325:         <span class="ruby-identifier">:access</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;/handlers/requestlog::access&quot;</span>, 
326:         <span class="ruby-identifier">:files</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;/handlers/requestlog::files&quot;</span>, 
327:         <span class="ruby-identifier">:objects</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;/handlers/requestlog::objects&quot;</span>, 
328:         <span class="ruby-identifier">:threads</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;/handlers/requestlog::threads&quot;</span>,
329:         <span class="ruby-identifier">:rails</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;/handlers/requestlog::params&quot;</span>
330:       }
331: 
332:       <span class="ruby-comment cmt"># turn on the debugging infrastructure, and ObjectTracker is a pig</span>
333:       <span class="ruby-constant">MongrelDbg</span>.<span class="ruby-identifier">configure</span>
334: 
335:       <span class="ruby-comment cmt"># now we roll through each requested debug type, turn it on and load that plugin</span>
336:       <span class="ruby-identifier">what</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">type</span><span class="ruby-operator">|</span> 
337:         <span class="ruby-constant">MongrelDbg</span>.<span class="ruby-identifier">begin_trace</span> <span class="ruby-identifier">type</span> 
338:         <span class="ruby-identifier">uri</span> <span class="ruby-identifier">location</span>, <span class="ruby-identifier">:handler</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">plugin</span>(<span class="ruby-identifier">handlers</span>[<span class="ruby-identifier">type</span>])
339:       <span class="ruby-keyword kw">end</span>
340:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000160" class="method-detail">
        <a name="M000160"></a>

        <div class="method-heading">
          <a href="#M000160" class="method-signature">
          <span class="method-name">join</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method should actually be called <b>outside</b> of the <a
href="Configurator.html">Configurator</a> block so that you can control it.
In other words do it like: config.join.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000160-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000160-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 302</span>
302:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">join</span>
303:       <span class="ruby-ivar">@listeners</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">acceptor</span>.<span class="ruby-identifier">join</span> }
304:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000138" class="method-detail">
        <a name="M000138"></a>

        <div class="method-heading">
          <a href="#M000138" class="method-signature">
          <span class="method-name">join</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method should actually be called <b>outside</b> of the <a
href="Configurator.html">Configurator</a> block so that you can control it.
In other words do it like: config.join.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000138-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000138-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 302</span>
302:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">join</span>
303:       <span class="ruby-ivar">@listeners</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">acceptor</span>.<span class="ruby-identifier">join</span> }
304:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000128" class="method-detail">
        <a name="M000128"></a>

        <div class="method-heading">
          <a href="#M000128" class="method-signature">
          <span class="method-name">listener</span><span class="method-args">(options={},&amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Starts a <a href="Configurator.html#M000128">listener</a> block. This is
the only one that actually takes a block and then you make <a
href="Configurator.html#M000129">Configurator.uri</a> calls in order to
setup your URIs and handlers. If you write your Handlers as GemPlugins then
you can use <a href="Configurator.html#M000131">load_plugins</a> and <a
href="Configurator.html#M000134">plugin</a> to load them.
</p>
<p>
It expects the following options (or defaults):
</p>
<ul>
<li>:host =&gt; Host name to bind.

</li>
<li>:port =&gt; Port to bind.

</li>
<li>:num_processors =&gt; The maximum number of concurrent threads allowed.

</li>
<li>:throttle =&gt; Time to pause (in hundredths of a second) between accepting
clients.

</li>
<li>:timeout =&gt; Time to wait (in seconds) before killing a stalled thread.

</li>
<li>:user =&gt; User to change to, must have :group as well.

</li>
<li>:group =&gt; Group to change to, must have :user as well.

</li>
</ul>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000128-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000128-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 132</span>
132:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">listener</span>(<span class="ruby-identifier">options</span>={},<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
133:       <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Cannot call listener inside another listener block.&quot;</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-ivar">@listener</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@listener_name</span>)
134:       <span class="ruby-identifier">ops</span> = <span class="ruby-identifier">resolve_defaults</span>(<span class="ruby-identifier">options</span>)
135:       <span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:num_processors</span>] <span class="ruby-operator">||=</span> <span class="ruby-value">950</span>
136:       <span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:throttle</span>] <span class="ruby-operator">||=</span> <span class="ruby-value">0</span>
137:       <span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:timeout</span>] <span class="ruby-operator">||=</span> <span class="ruby-value">60</span>
138: 
139:       <span class="ruby-ivar">@listener</span> = <span class="ruby-constant">Mongrel</span><span class="ruby-operator">::</span><span class="ruby-constant">HttpServer</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:host</span>], <span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:port</span>].<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:num_processors</span>].<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:throttle</span>].<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:timeout</span>].<span class="ruby-identifier">to_i</span>)
140:       <span class="ruby-ivar">@listener_name</span> = <span class="ruby-node">&quot;#{ops[:host]}:#{ops[:port]}&quot;</span>
141:       <span class="ruby-ivar">@listeners</span>[<span class="ruby-ivar">@listener_name</span>] = <span class="ruby-ivar">@listener</span>
142: 
143:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:user</span>] <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:group</span>]
144:         <span class="ruby-identifier">change_privilege</span>(<span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:user</span>], <span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:group</span>])
145:       <span class="ruby-keyword kw">end</span>
146: 
147:       <span class="ruby-comment cmt"># Does the actual cloaking operation to give the new implicit self.</span>
148:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block</span>
149:         <span class="ruby-identifier">cloaker</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>).<span class="ruby-identifier">bind</span>(<span class="ruby-keyword kw">self</span>).<span class="ruby-identifier">call</span>
150:       <span class="ruby-keyword kw">end</span>
151: 
152:       <span class="ruby-comment cmt"># all done processing this listener setup, reset implicit variables</span>
153:       <span class="ruby-ivar">@listener</span> = <span class="ruby-keyword kw">nil</span>
154:       <span class="ruby-ivar">@listener_name</span> = <span class="ruby-keyword kw">nil</span>
155:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000150" class="method-detail">
        <a name="M000150"></a>

        <div class="method-heading">
          <a href="#M000150" class="method-signature">
          <span class="method-name">listener</span><span class="method-args">(options={},&amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Starts a <a href="Configurator.html#M000128">listener</a> block. This is
the only one that actually takes a block and then you make <a
href="Configurator.html#M000129">Configurator.uri</a> calls in order to
setup your URIs and handlers. If you write your Handlers as GemPlugins then
you can use <a href="Configurator.html#M000131">load_plugins</a> and <a
href="Configurator.html#M000134">plugin</a> to load them.
</p>
<p>
It expects the following options (or defaults):
</p>
<ul>
<li>:host =&gt; Host name to bind.

</li>
<li>:port =&gt; Port to bind.

</li>
<li>:num_processors =&gt; The maximum number of concurrent threads allowed.

</li>
<li>:throttle =&gt; Time to pause (in hundredths of a second) between accepting
clients.

</li>
<li>:timeout =&gt; Time to wait (in seconds) before killing a stalled thread.

</li>
<li>:user =&gt; User to change to, must have :group as well.

</li>
<li>:group =&gt; Group to change to, must have :user as well.

</li>
</ul>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000150-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000150-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 132</span>
132:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">listener</span>(<span class="ruby-identifier">options</span>={},<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
133:       <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Cannot call listener inside another listener block.&quot;</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-ivar">@listener</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@listener_name</span>)
134:       <span class="ruby-identifier">ops</span> = <span class="ruby-identifier">resolve_defaults</span>(<span class="ruby-identifier">options</span>)
135:       <span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:num_processors</span>] <span class="ruby-operator">||=</span> <span class="ruby-value">950</span>
136:       <span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:throttle</span>] <span class="ruby-operator">||=</span> <span class="ruby-value">0</span>
137:       <span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:timeout</span>] <span class="ruby-operator">||=</span> <span class="ruby-value">60</span>
138: 
139:       <span class="ruby-ivar">@listener</span> = <span class="ruby-constant">Mongrel</span><span class="ruby-operator">::</span><span class="ruby-constant">HttpServer</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:host</span>], <span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:port</span>].<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:num_processors</span>].<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:throttle</span>].<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:timeout</span>].<span class="ruby-identifier">to_i</span>)
140:       <span class="ruby-ivar">@listener_name</span> = <span class="ruby-node">&quot;#{ops[:host]}:#{ops[:port]}&quot;</span>
141:       <span class="ruby-ivar">@listeners</span>[<span class="ruby-ivar">@listener_name</span>] = <span class="ruby-ivar">@listener</span>
142: 
143:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:user</span>] <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:group</span>]
144:         <span class="ruby-identifier">change_privilege</span>(<span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:user</span>], <span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:group</span>])
145:       <span class="ruby-keyword kw">end</span>
146: 
147:       <span class="ruby-comment cmt"># Does the actual cloaking operation to give the new implicit self.</span>
148:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block</span>
149:         <span class="ruby-identifier">cloaker</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>).<span class="ruby-identifier">bind</span>(<span class="ruby-keyword kw">self</span>).<span class="ruby-identifier">call</span>
150:       <span class="ruby-keyword kw">end</span>
151: 
152:       <span class="ruby-comment cmt"># all done processing this listener setup, reset implicit variables</span>
153:       <span class="ruby-ivar">@listener</span> = <span class="ruby-keyword kw">nil</span>
154:       <span class="ruby-ivar">@listener_name</span> = <span class="ruby-keyword kw">nil</span>
155:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000133" class="method-detail">
        <a name="M000133"></a>

        <div class="method-heading">
          <a href="#M000133" class="method-signature">
          <span class="method-name">load_mime_map</span><span class="method-args">(file, mime={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Loads the MIME map file and checks that it is correct on loading. This is
commonly passed to <a href="DirHandler.html">Mongrel::DirHandler</a> or any
framework handler that uses <a href="DirHandler.html">DirHandler</a> to
serve files. You can also include a set of default MIME types as additional
settings. See <a href="DirHandler.html">Mongrel::DirHandler</a> for how the
MIME types map is organized.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000133-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000133-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 247</span>
247:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">load_mime_map</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">mime</span>={})
248:       <span class="ruby-comment cmt"># configure any requested mime map</span>
249:       <span class="ruby-identifier">mime</span> = <span class="ruby-identifier">load_yaml</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">mime</span>)
250: 
251:       <span class="ruby-comment cmt"># check all the mime types to make sure they are the right format</span>
252:       <span class="ruby-identifier">mime</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">log</span> <span class="ruby-node">&quot;WARNING: MIME type #{k} must start with '.'&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">index</span>(<span class="ruby-value str">&quot;.&quot;</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> }
253: 
254:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">mime</span>
255:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000155" class="method-detail">
        <a name="M000155"></a>

        <div class="method-heading">
          <a href="#M000155" class="method-signature">
          <span class="method-name">load_mime_map</span><span class="method-args">(file, mime={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Loads the MIME map file and checks that it is correct on loading. This is
commonly passed to <a href="DirHandler.html">Mongrel::DirHandler</a> or any
framework handler that uses <a href="DirHandler.html">DirHandler</a> to
serve files. You can also include a set of default MIME types as additional
settings. See <a href="DirHandler.html">Mongrel::DirHandler</a> for how the
MIME types map is organized.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000155-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000155-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 247</span>
247:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">load_mime_map</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">mime</span>={})
248:       <span class="ruby-comment cmt"># configure any requested mime map</span>
249:       <span class="ruby-identifier">mime</span> = <span class="ruby-identifier">load_yaml</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">mime</span>)
250: 
251:       <span class="ruby-comment cmt"># check all the mime types to make sure they are the right format</span>
252:       <span class="ruby-identifier">mime</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">log</span> <span class="ruby-node">&quot;WARNING: MIME type #{k} must start with '.'&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">index</span>(<span class="ruby-value str">&quot;.&quot;</span>) <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> }
253: 
254:       <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">mime</span>
255:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000153" class="method-detail">
        <a name="M000153"></a>

        <div class="method-heading">
          <a href="#M000153" class="method-signature">
          <span class="method-name">load_plugins</span><span class="method-args">(options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Uses the GemPlugin system to easily load plugins based on their gem
dependencies. You pass in either an :includes =&gt; [] or :excludes =&gt;
[] setting listing the names of plugins to include or exclude from the
determining the dependencies.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000153-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000153-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 215</span>
215:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">load_plugins</span>(<span class="ruby-identifier">options</span>={})
216:       <span class="ruby-identifier">ops</span> = <span class="ruby-identifier">resolve_defaults</span>(<span class="ruby-identifier">options</span>)
217: 
218:       <span class="ruby-identifier">load_settings</span> = {}
219:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:includes</span>]
220:         <span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:includes</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">plugin</span><span class="ruby-operator">|</span>
221:           <span class="ruby-identifier">load_settings</span>[<span class="ruby-identifier">plugin</span>] = <span class="ruby-constant">GemPlugin</span><span class="ruby-operator">::</span><span class="ruby-constant">INCLUDE</span>
222:         <span class="ruby-keyword kw">end</span>
223:       <span class="ruby-keyword kw">end</span>
224: 
225:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:excludes</span>]
226:         <span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:excludes</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">plugin</span><span class="ruby-operator">|</span>
227:           <span class="ruby-identifier">load_settings</span>[<span class="ruby-identifier">plugin</span>] = <span class="ruby-constant">GemPlugin</span><span class="ruby-operator">::</span><span class="ruby-constant">EXCLUDE</span>
228:         <span class="ruby-keyword kw">end</span>
229:       <span class="ruby-keyword kw">end</span>
230: 
231:       <span class="ruby-constant">GemPlugin</span><span class="ruby-operator">::</span><span class="ruby-constant">Manager</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">load</span>(<span class="ruby-identifier">load_settings</span>)
232:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000131" class="method-detail">
        <a name="M000131"></a>

        <div class="method-heading">
          <a href="#M000131" class="method-signature">
          <span class="method-name">load_plugins</span><span class="method-args">(options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Uses the GemPlugin system to easily load plugins based on their gem
dependencies. You pass in either an :includes =&gt; [] or :excludes =&gt;
[] setting listing the names of plugins to include or exclude from the
determining the dependencies.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000131-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000131-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 215</span>
215:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">load_plugins</span>(<span class="ruby-identifier">options</span>={})
216:       <span class="ruby-identifier">ops</span> = <span class="ruby-identifier">resolve_defaults</span>(<span class="ruby-identifier">options</span>)
217: 
218:       <span class="ruby-identifier">load_settings</span> = {}
219:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:includes</span>]
220:         <span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:includes</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">plugin</span><span class="ruby-operator">|</span>
221:           <span class="ruby-identifier">load_settings</span>[<span class="ruby-identifier">plugin</span>] = <span class="ruby-constant">GemPlugin</span><span class="ruby-operator">::</span><span class="ruby-constant">INCLUDE</span>
222:         <span class="ruby-keyword kw">end</span>
223:       <span class="ruby-keyword kw">end</span>
224: 
225:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:excludes</span>]
226:         <span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:excludes</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">plugin</span><span class="ruby-operator">|</span>
227:           <span class="ruby-identifier">load_settings</span>[<span class="ruby-identifier">plugin</span>] = <span class="ruby-constant">GemPlugin</span><span class="ruby-operator">::</span><span class="ruby-constant">EXCLUDE</span>
228:         <span class="ruby-keyword kw">end</span>
229:       <span class="ruby-keyword kw">end</span>
230: 
231:       <span class="ruby-constant">GemPlugin</span><span class="ruby-operator">::</span><span class="ruby-constant">Manager</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">load</span>(<span class="ruby-identifier">load_settings</span>)
232:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000154" class="method-detail">
        <a name="M000154"></a>

        <div class="method-heading">
          <a href="#M000154" class="method-signature">
          <span class="method-name">load_yaml</span><span class="method-args">(file, default={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Easy way to load a YAML file and apply default settings.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000154-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000154-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 236</span>
236:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">load_yaml</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">default</span>={})
237:       <span class="ruby-identifier">default</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-constant">YAML</span>.<span class="ruby-identifier">load_file</span>(<span class="ruby-identifier">file</span>))
238:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000132" class="method-detail">
        <a name="M000132"></a>

        <div class="method-heading">
          <a href="#M000132" class="method-signature">
          <span class="method-name">load_yaml</span><span class="method-args">(file, default={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Easy way to load a YAML file and apply default settings.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000132-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000132-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 236</span>
236:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">load_yaml</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">default</span>={})
237:       <span class="ruby-identifier">default</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-constant">YAML</span>.<span class="ruby-identifier">load_file</span>(<span class="ruby-identifier">file</span>))
238:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000164" class="method-detail">
        <a name="M000164"></a>

        <div class="method-heading">
          <a href="#M000164" class="method-signature">
          <span class="method-name">log</span><span class="method-args">(msg)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Logs a simple message to STDERR (or the mongrel <a
href="Configurator.html#M000142">log</a> if in daemon mode).
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000164-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000164-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 383</span>
383:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">log</span>(<span class="ruby-identifier">msg</span>)
384:       <span class="ruby-constant">STDERR</span>.<span class="ruby-identifier">print</span> <span class="ruby-value str">&quot;** &quot;</span>, <span class="ruby-identifier">msg</span>, <span class="ruby-value str">&quot;\n&quot;</span>
385:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000142" class="method-detail">
        <a name="M000142"></a>

        <div class="method-heading">
          <a href="#M000142" class="method-signature">
          <span class="method-name">log</span><span class="method-args">(msg)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Logs a simple message to STDERR (or the mongrel <a
href="Configurator.html#M000142">log</a> if in daemon mode).
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000142-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000142-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 383</span>
383:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">log</span>(<span class="ruby-identifier">msg</span>)
384:       <span class="ruby-constant">STDERR</span>.<span class="ruby-identifier">print</span> <span class="ruby-value str">&quot;** &quot;</span>, <span class="ruby-identifier">msg</span>, <span class="ruby-value str">&quot;\n&quot;</span>
385:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000134" class="method-detail">
        <a name="M000134"></a>

        <div class="method-heading">
          <a href="#M000134" class="method-signature">
          <span class="method-name">plugin</span><span class="method-args">(name, options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Loads and creates a <a href="Configurator.html#M000134">plugin</a> for you
based on the given name and configured with the selected options. The
options are merged with the defaults prior to passing them in.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000134-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000134-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 261</span>
261:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">plugin</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">options</span>={})
262:       <span class="ruby-identifier">ops</span> = <span class="ruby-identifier">resolve_defaults</span>(<span class="ruby-identifier">options</span>)
263:       <span class="ruby-constant">GemPlugin</span><span class="ruby-operator">::</span><span class="ruby-constant">Manager</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">ops</span>)
264:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000156" class="method-detail">
        <a name="M000156"></a>

        <div class="method-heading">
          <a href="#M000156" class="method-signature">
          <span class="method-name">plugin</span><span class="method-args">(name, options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Loads and creates a <a href="Configurator.html#M000134">plugin</a> for you
based on the given name and configured with the selected options. The
options are merged with the defaults prior to passing them in.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000156-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000156-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 261</span>
261:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">plugin</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">options</span>={})
262:       <span class="ruby-identifier">ops</span> = <span class="ruby-identifier">resolve_defaults</span>(<span class="ruby-identifier">options</span>)
263:       <span class="ruby-constant">GemPlugin</span><span class="ruby-operator">::</span><span class="ruby-constant">Manager</span>.<span class="ruby-identifier">instance</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">ops</span>)
264:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000157" class="method-detail">
        <a name="M000157"></a>

        <div class="method-heading">
          <a href="#M000157" class="method-signature">
          <span class="method-name">redirect</span><span class="method-args">(from, pattern, replacement = nil, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Lets you do redirects easily as described in <a
href="RedirectHandler.html">Mongrel::RedirectHandler</a>. You use it inside
the configurator like this:
</p>
<pre>
  redirect(&quot;/test&quot;, &quot;/to/there&quot;) # simple
  redirect(&quot;/to&quot;, /t/, 'w') # regexp
  redirect(&quot;/hey&quot;, /(w+)/) {|match| ...}  # block
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000157-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000157-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 273</span>
273:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">redirect</span>(<span class="ruby-identifier">from</span>, <span class="ruby-identifier">pattern</span>, <span class="ruby-identifier">replacement</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
274:       <span class="ruby-identifier">uri</span> <span class="ruby-identifier">from</span>, <span class="ruby-identifier">:handler</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Mongrel</span><span class="ruby-operator">::</span><span class="ruby-constant">RedirectHandler</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">pattern</span>, <span class="ruby-identifier">replacement</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
275:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000135" class="method-detail">
        <a name="M000135"></a>

        <div class="method-heading">
          <a href="#M000135" class="method-signature">
          <span class="method-name">redirect</span><span class="method-args">(from, pattern, replacement = nil, &amp;block)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Lets you do redirects easily as described in <a
href="RedirectHandler.html">Mongrel::RedirectHandler</a>. You use it inside
the configurator like this:
</p>
<pre>
  redirect(&quot;/test&quot;, &quot;/to/there&quot;) # simple
  redirect(&quot;/to&quot;, /t/, 'w') # regexp
  redirect(&quot;/hey&quot;, /(w+)/) {|match| ...}  # block
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000135-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000135-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 273</span>
273:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">redirect</span>(<span class="ruby-identifier">from</span>, <span class="ruby-identifier">pattern</span>, <span class="ruby-identifier">replacement</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
274:       <span class="ruby-identifier">uri</span> <span class="ruby-identifier">from</span>, <span class="ruby-identifier">:handler</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Mongrel</span><span class="ruby-operator">::</span><span class="ruby-constant">RedirectHandler</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">pattern</span>, <span class="ruby-identifier">replacement</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
275:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000123" class="method-detail">
        <a name="M000123"></a>

        <div class="method-heading">
          <a href="#M000123" class="method-signature">
          <span class="method-name">remove_pid_file</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000123-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000123-source">
<pre>
    <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 78</span>
78:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remove_pid_file</span>
79:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">unlink</span>(<span class="ruby-ivar">@pid_file</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@pid_file</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-ivar">@pid_file</span>)
80:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000145" class="method-detail">
        <a name="M000145"></a>

        <div class="method-heading">
          <a href="#M000145" class="method-signature">
          <span class="method-name">remove_pid_file</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000145-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000145-source">
<pre>
    <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 78</span>
78:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remove_pid_file</span>
79:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">unlink</span>(<span class="ruby-ivar">@pid_file</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@pid_file</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-ivar">@pid_file</span>)
80:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000149" class="method-detail">
        <a name="M000149"></a>

        <div class="method-heading">
          <a href="#M000149" class="method-signature">
          <span class="method-name">resolve_defaults</span><span class="method-args">(options)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This will resolve the given options against the defaults. Normally just
used internally.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000149-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000149-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 113</span>
113:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">resolve_defaults</span>(<span class="ruby-identifier">options</span>)
114:       <span class="ruby-identifier">options</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-ivar">@defaults</span>)
115:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000127" class="method-detail">
        <a name="M000127"></a>

        <div class="method-heading">
          <a href="#M000127" class="method-signature">
          <span class="method-name">resolve_defaults</span><span class="method-args">(options)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This will resolve the given options against the defaults. Normally just
used internally.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000127-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000127-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 113</span>
113:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">resolve_defaults</span>(<span class="ruby-identifier">options</span>)
114:       <span class="ruby-identifier">options</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-ivar">@defaults</span>)
115:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000158" class="method-detail">
        <a name="M000158"></a>

        <div class="method-heading">
          <a href="#M000158" class="method-signature">
          <span class="method-name">run</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Works like a meta <a href="Configurator.html#M000136">run</a> method which
goes through all the configured listeners. Use the <a
href="Configurator.html#M000138">Configurator.join</a> method to prevent
Ruby from exiting until each one is done.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000158-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000158-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 280</span>
280:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">run</span>
281:       <span class="ruby-ivar">@listeners</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">name</span>,<span class="ruby-identifier">s</span><span class="ruby-operator">|</span> 
282:         <span class="ruby-identifier">s</span>.<span class="ruby-identifier">run</span> 
283:       }
284: 
285:       <span class="ruby-identifier">$mongrel_sleeper_thread</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">new</span> { <span class="ruby-identifier">loop</span> { <span class="ruby-identifier">sleep</span> <span class="ruby-value">1</span> } }
286:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000136" class="method-detail">
        <a name="M000136"></a>

        <div class="method-heading">
          <a href="#M000136" class="method-signature">
          <span class="method-name">run</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Works like a meta <a href="Configurator.html#M000136">run</a> method which
goes through all the configured listeners. Use the <a
href="Configurator.html#M000138">Configurator.join</a> method to prevent
Ruby from exiting until each one is done.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000136-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000136-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 280</span>
280:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">run</span>
281:       <span class="ruby-ivar">@listeners</span>.<span class="ruby-identifier">each</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">name</span>,<span class="ruby-identifier">s</span><span class="ruby-operator">|</span> 
282:         <span class="ruby-identifier">s</span>.<span class="ruby-identifier">run</span> 
283:       }
284: 
285:       <span class="ruby-identifier">$mongrel_sleeper_thread</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">new</span> { <span class="ruby-identifier">loop</span> { <span class="ruby-identifier">sleep</span> <span class="ruby-value">1</span> } }
286:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000162" class="method-detail">
        <a name="M000162"></a>

        <div class="method-heading">
          <a href="#M000162" class="method-signature">
          <span class="method-name">run_config</span><span class="method-args">(script)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Used to allow you to let users specify their own configurations inside your
<a href="Configurator.html">Configurator</a> setup. You pass it a script
name and it reads it in and does an eval on the contents passing in the
right binding so they can put their own <a
href="Configurator.html">Configurator</a> statements.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000162-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000162-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 346</span>
346:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">run_config</span>(<span class="ruby-identifier">script</span>)
347:       <span class="ruby-identifier">open</span>(<span class="ruby-identifier">script</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">eval</span>(<span class="ruby-identifier">f</span>.<span class="ruby-identifier">read</span>, <span class="ruby-identifier">proc</span> {<span class="ruby-keyword kw">self</span>}) }
348:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000140" class="method-detail">
        <a name="M000140"></a>

        <div class="method-heading">
          <a href="#M000140" class="method-signature">
          <span class="method-name">run_config</span><span class="method-args">(script)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Used to allow you to let users specify their own configurations inside your
<a href="Configurator.html">Configurator</a> setup. You pass it a script
name and it reads it in and does an eval on the contents passing in the
right binding so they can put their own <a
href="Configurator.html">Configurator</a> statements.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000140-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000140-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 346</span>
346:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">run_config</span>(<span class="ruby-identifier">script</span>)
347:       <span class="ruby-identifier">open</span>(<span class="ruby-identifier">script</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">eval</span>(<span class="ruby-identifier">f</span>.<span class="ruby-identifier">read</span>, <span class="ruby-identifier">proc</span> {<span class="ruby-keyword kw">self</span>}) }
348:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000141" class="method-detail">
        <a name="M000141"></a>

        <div class="method-heading">
          <a href="#M000141" class="method-signature">
          <span class="method-name">setup_signals</span><span class="method-args">(options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets up the standard signal handlers that are used on most Ruby It only
configures if the platform is not win32 and doesn&#8216;t do a HUP signal
since this is typically framework specific.
</p>
<p>
Requires a :pid_file option given to <a
href="Configurator.html#M000121">Configurator.new</a> to indicate a file to
delete. It sets the MongrelConfig.needs_restart attribute if the start
command should reload. It&#8216;s up to you to detect this and do whatever
is needed for a &quot;restart&quot;.
</p>
<p>
This command is safely ignored if the platform is win32 (with a warning)
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000141-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000141-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 360</span>
360:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">setup_signals</span>(<span class="ruby-identifier">options</span>={})
361:       <span class="ruby-identifier">ops</span> = <span class="ruby-identifier">resolve_defaults</span>(<span class="ruby-identifier">options</span>)
362: 
363:       <span class="ruby-comment cmt"># forced shutdown, even if previously restarted (actually just like TERM but for CTRL-C)</span>
364:       <span class="ruby-identifier">trap</span>(<span class="ruby-value str">&quot;INT&quot;</span>) { <span class="ruby-identifier">log</span> <span class="ruby-value str">&quot;INT signal received.&quot;</span>; <span class="ruby-identifier">stop</span>(<span class="ruby-keyword kw">false</span>) }
365: 
366:       <span class="ruby-comment cmt"># clean up the pid file always</span>
367:       <span class="ruby-identifier">at_exit</span> { <span class="ruby-identifier">remove_pid_file</span> }
368: 
369:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">RUBY_PLATFORM</span> <span class="ruby-operator">!~</span> <span class="ruby-regexp re">/mswin/</span>
370:         <span class="ruby-comment cmt"># graceful shutdown</span>
371:         <span class="ruby-identifier">trap</span>(<span class="ruby-value str">&quot;TERM&quot;</span>) { <span class="ruby-identifier">log</span> <span class="ruby-value str">&quot;TERM signal received.&quot;</span>; <span class="ruby-identifier">stop</span> }
372:         <span class="ruby-identifier">trap</span>(<span class="ruby-value str">&quot;USR1&quot;</span>) { <span class="ruby-identifier">log</span> <span class="ruby-node">&quot;USR1 received, toggling $mongrel_debug_client to #{!$mongrel_debug_client}&quot;</span>; <span class="ruby-identifier">$mongrel_debug_client</span> = <span class="ruby-operator">!</span><span class="ruby-identifier">$mongrel_debug_client</span> }
373:         <span class="ruby-comment cmt"># restart</span>
374:         <span class="ruby-identifier">trap</span>(<span class="ruby-value str">&quot;USR2&quot;</span>) { <span class="ruby-identifier">log</span> <span class="ruby-value str">&quot;USR2 signal received.&quot;</span>; <span class="ruby-identifier">stop</span>(<span class="ruby-keyword kw">true</span>) }
375: 
376:         <span class="ruby-identifier">log</span> <span class="ruby-value str">&quot;Signals ready.  TERM =&gt; stop.  USR2 =&gt; restart.  INT =&gt; stop (no restart).&quot;</span>
377:       <span class="ruby-keyword kw">else</span>
378:         <span class="ruby-identifier">log</span> <span class="ruby-value str">&quot;Signals ready.  INT =&gt; stop (no restart).&quot;</span>
379:       <span class="ruby-keyword kw">end</span>
380:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000163" class="method-detail">
        <a name="M000163"></a>

        <div class="method-heading">
          <a href="#M000163" class="method-signature">
          <span class="method-name">setup_signals</span><span class="method-args">(options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets up the standard signal handlers that are used on most Ruby It only
configures if the platform is not win32 and doesn&#8216;t do a HUP signal
since this is typically framework specific.
</p>
<p>
Requires a :pid_file option given to <a
href="Configurator.html#M000121">Configurator.new</a> to indicate a file to
delete. It sets the MongrelConfig.needs_restart attribute if the start
command should reload. It&#8216;s up to you to detect this and do whatever
is needed for a &quot;restart&quot;.
</p>
<p>
This command is safely ignored if the platform is win32 (with a warning)
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000163-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000163-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 360</span>
360:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">setup_signals</span>(<span class="ruby-identifier">options</span>={})
361:       <span class="ruby-identifier">ops</span> = <span class="ruby-identifier">resolve_defaults</span>(<span class="ruby-identifier">options</span>)
362: 
363:       <span class="ruby-comment cmt"># forced shutdown, even if previously restarted (actually just like TERM but for CTRL-C)</span>
364:       <span class="ruby-identifier">trap</span>(<span class="ruby-value str">&quot;INT&quot;</span>) { <span class="ruby-identifier">log</span> <span class="ruby-value str">&quot;INT signal received.&quot;</span>; <span class="ruby-identifier">stop</span>(<span class="ruby-keyword kw">false</span>) }
365: 
366:       <span class="ruby-comment cmt"># clean up the pid file always</span>
367:       <span class="ruby-identifier">at_exit</span> { <span class="ruby-identifier">remove_pid_file</span> }
368: 
369:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">RUBY_PLATFORM</span> <span class="ruby-operator">!~</span> <span class="ruby-regexp re">/mswin/</span>
370:         <span class="ruby-comment cmt"># graceful shutdown</span>
371:         <span class="ruby-identifier">trap</span>(<span class="ruby-value str">&quot;TERM&quot;</span>) { <span class="ruby-identifier">log</span> <span class="ruby-value str">&quot;TERM signal received.&quot;</span>; <span class="ruby-identifier">stop</span> }
372:         <span class="ruby-identifier">trap</span>(<span class="ruby-value str">&quot;USR1&quot;</span>) { <span class="ruby-identifier">log</span> <span class="ruby-node">&quot;USR1 received, toggling $mongrel_debug_client to #{!$mongrel_debug_client}&quot;</span>; <span class="ruby-identifier">$mongrel_debug_client</span> = <span class="ruby-operator">!</span><span class="ruby-identifier">$mongrel_debug_client</span> }
373:         <span class="ruby-comment cmt"># restart</span>
374:         <span class="ruby-identifier">trap</span>(<span class="ruby-value str">&quot;USR2&quot;</span>) { <span class="ruby-identifier">log</span> <span class="ruby-value str">&quot;USR2 signal received.&quot;</span>; <span class="ruby-identifier">stop</span>(<span class="ruby-keyword kw">true</span>) }
375: 
376:         <span class="ruby-identifier">log</span> <span class="ruby-value str">&quot;Signals ready.  TERM =&gt; stop.  USR2 =&gt; restart.  INT =&gt; stop (no restart).&quot;</span>
377:       <span class="ruby-keyword kw">else</span>
378:         <span class="ruby-identifier">log</span> <span class="ruby-value str">&quot;Signals ready.  INT =&gt; stop (no restart).&quot;</span>
379:       <span class="ruby-keyword kw">end</span>
380:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000159" class="method-detail">
        <a name="M000159"></a>

        <div class="method-heading">
          <a href="#M000159" class="method-signature">
          <span class="method-name">stop</span><span class="method-args">(needs_restart=false, synchronous=false)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Calls .<a href="Configurator.html#M000137">stop</a> on all the configured
listeners so they <a href="Configurator.html#M000137">stop</a> processing
requests (gracefully). By default it assumes that you don&#8216;t want to
restart.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000159-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000159-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 291</span>
291:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">stop</span>(<span class="ruby-identifier">needs_restart</span>=<span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">synchronous</span>=<span class="ruby-keyword kw">false</span>)   
292:       <span class="ruby-ivar">@listeners</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>,<span class="ruby-identifier">s</span><span class="ruby-operator">|</span> 
293:         <span class="ruby-identifier">s</span>.<span class="ruby-identifier">stop</span>(<span class="ruby-identifier">synchronous</span>)      
294:       <span class="ruby-keyword kw">end</span>      
295:       <span class="ruby-ivar">@needs_restart</span> = <span class="ruby-identifier">needs_restart</span>
296:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000137" class="method-detail">
        <a name="M000137"></a>

        <div class="method-heading">
          <a href="#M000137" class="method-signature">
          <span class="method-name">stop</span><span class="method-args">(needs_restart=false, synchronous=false)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Calls .<a href="Configurator.html#M000137">stop</a> on all the configured
listeners so they <a href="Configurator.html#M000137">stop</a> processing
requests (gracefully). By default it assumes that you don&#8216;t want to
restart.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000137-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000137-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 291</span>
291:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">stop</span>(<span class="ruby-identifier">needs_restart</span>=<span class="ruby-keyword kw">false</span>, <span class="ruby-identifier">synchronous</span>=<span class="ruby-keyword kw">false</span>)   
292:       <span class="ruby-ivar">@listeners</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>,<span class="ruby-identifier">s</span><span class="ruby-operator">|</span> 
293:         <span class="ruby-identifier">s</span>.<span class="ruby-identifier">stop</span>(<span class="ruby-identifier">synchronous</span>)      
294:       <span class="ruby-keyword kw">end</span>      
295:       <span class="ruby-ivar">@needs_restart</span> = <span class="ruby-identifier">needs_restart</span>
296:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000129" class="method-detail">
        <a name="M000129"></a>

        <div class="method-heading">
          <a href="#M000129" class="method-signature">
          <span class="method-name">uri</span><span class="method-args">(location, options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Called inside a <a
href="Configurator.html#M000128">Configurator.listener</a> block in order
to add URI-&gt;handler mappings for that <a
href="Configurator.html#M000128">listener</a>. Use this as many times as
you like. It expects the following options or defaults:
</p>
<ul>
<li>:handler =&gt; <a href="HttpHandler.html">HttpHandler</a> &#8212; Handler
to use for this location.

</li>
<li>:in_front =&gt; true/false &#8212; Rather than appending, it prepends this
handler.

</li>
</ul>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000129-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000129-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 165</span>
165:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">uri</span>(<span class="ruby-identifier">location</span>, <span class="ruby-identifier">options</span>={})
166:       <span class="ruby-identifier">ops</span> = <span class="ruby-identifier">resolve_defaults</span>(<span class="ruby-identifier">options</span>)
167:       <span class="ruby-ivar">@listener</span>.<span class="ruby-identifier">register</span>(<span class="ruby-identifier">location</span>, <span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:handler</span>], <span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:in_front</span>])
168:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000151" class="method-detail">
        <a name="M000151"></a>

        <div class="method-heading">
          <a href="#M000151" class="method-signature">
          <span class="method-name">uri</span><span class="method-args">(location, options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Called inside a <a
href="Configurator.html#M000128">Configurator.listener</a> block in order
to add URI-&gt;handler mappings for that <a
href="Configurator.html#M000128">listener</a>. Use this as many times as
you like. It expects the following options or defaults:
</p>
<ul>
<li>:handler =&gt; <a href="HttpHandler.html">HttpHandler</a> &#8212; Handler
to use for this location.

</li>
<li>:in_front =&gt; true/false &#8212; Rather than appending, it prepends this
handler.

</li>
</ul>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000151-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000151-source">
<pre>
     <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 165</span>
165:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">uri</span>(<span class="ruby-identifier">location</span>, <span class="ruby-identifier">options</span>={})
166:       <span class="ruby-identifier">ops</span> = <span class="ruby-identifier">resolve_defaults</span>(<span class="ruby-identifier">options</span>)
167:       <span class="ruby-ivar">@listener</span>.<span class="ruby-identifier">register</span>(<span class="ruby-identifier">location</span>, <span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:handler</span>], <span class="ruby-identifier">ops</span>[<span class="ruby-identifier">:in_front</span>])
168:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000124" class="method-detail">
        <a name="M000124"></a>

        <div class="method-heading">
          <a href="#M000124" class="method-signature">
          <span class="method-name">write_pid_file</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Writes the PID file if we&#8216;re not on Windows.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000124-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000124-source">
<pre>
    <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 83</span>
83:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">write_pid_file</span>
84:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">RUBY_PLATFORM</span> <span class="ruby-operator">!~</span> <span class="ruby-regexp re">/mswin/</span>
85:         <span class="ruby-identifier">log</span> <span class="ruby-node">&quot;Writing PID file to #{@pid_file}&quot;</span>
86:         <span class="ruby-identifier">open</span>(<span class="ruby-ivar">@pid_file</span>,<span class="ruby-value str">&quot;w&quot;</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">write</span>(<span class="ruby-constant">Process</span>.<span class="ruby-identifier">pid</span>) }
87:         <span class="ruby-identifier">open</span>(<span class="ruby-ivar">@pid_file</span>,<span class="ruby-value str">&quot;w&quot;</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
88:           <span class="ruby-identifier">f</span>.<span class="ruby-identifier">write</span>(<span class="ruby-constant">Process</span>.<span class="ruby-identifier">pid</span>)
89:           <span class="ruby-constant">File</span>.<span class="ruby-identifier">chmod</span>(<span class="ruby-value">0644</span>, <span class="ruby-ivar">@pid_file</span>)
90:         <span class="ruby-keyword kw">end</span>      
91:       <span class="ruby-keyword kw">end</span>
92:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000146" class="method-detail">
        <a name="M000146"></a>

        <div class="method-heading">
          <a href="#M000146" class="method-signature">
          <span class="method-name">write_pid_file</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Writes the PID file if we&#8216;re not on Windows.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000146-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000146-source">
<pre>
    <span class="ruby-comment cmt"># File lib/mongrel/configurator.rb, line 83</span>
83:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">write_pid_file</span>
84:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">RUBY_PLATFORM</span> <span class="ruby-operator">!~</span> <span class="ruby-regexp re">/mswin/</span>
85:         <span class="ruby-identifier">log</span> <span class="ruby-node">&quot;Writing PID file to #{@pid_file}&quot;</span>
86:         <span class="ruby-identifier">open</span>(<span class="ruby-ivar">@pid_file</span>,<span class="ruby-value str">&quot;w&quot;</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">write</span>(<span class="ruby-constant">Process</span>.<span class="ruby-identifier">pid</span>) }
87:         <span class="ruby-identifier">open</span>(<span class="ruby-ivar">@pid_file</span>,<span class="ruby-value str">&quot;w&quot;</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
88:           <span class="ruby-identifier">f</span>.<span class="ruby-identifier">write</span>(<span class="ruby-constant">Process</span>.<span class="ruby-identifier">pid</span>)
89:           <span class="ruby-constant">File</span>.<span class="ruby-identifier">chmod</span>(<span class="ruby-value">0644</span>, <span class="ruby-ivar">@pid_file</span>)
90:         <span class="ruby-keyword kw">end</span>      
91:       <span class="ruby-keyword kw">end</span>
92:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>